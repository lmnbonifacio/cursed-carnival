<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Spectral Bridge</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- GAME CONTAINER --- */
        .game-wrapper {
            position: relative; 
            width: 100%; max-width: 1000px; 
            aspect-ratio: 2/1; 
            margin: 20px auto;
            background-color: #020205; 
            background-image: radial-gradient(circle at 50% 50%, #11111f 0%, #020205 100%);
            border: 2px solid #463a20; /* Slightly thicker border for definition */
            box-shadow: 0 0 60px rgba(0,0,0,0.9);
            border-radius: 12px; 
            overflow: hidden;
            touch-action: none; 
            cursor: default; 
            user-select: none;
        }

        /* --- UI --- */
        .overlay-panel {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 10, 0.9); 
            z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.4s;
            padding: 20px; text-align: center;
        }
        .hidden { opacity: 0; pointer-events: none; }

        .difficulty-grid { display: flex; gap: 20px; margin-top: 30px; flex-wrap: wrap; justify-content: center; }

        .diff-btn {
            width: 60px; height: 60px; 
            padding: 0 !important; border-radius: 50%;
            background: rgba(0,0,0,0.5); border: 2px solid #c5a059; color: #c5a059;
            font-size: 1.4rem; font-family: 'Cinzel', serif; font-weight: bold;
            display: flex; justify-content: center; align-items: center;
            margin: 0 !important; cursor: pointer;
        }
        .diff-btn:hover { background: #c5a059; color: #000; transform: scale(1.1); }

        .status-msg {
            font-family: 'Cinzel', serif; font-size: 4rem; letter-spacing: 5px; text-transform: uppercase;
            text-shadow: 0 0 30px currentColor; margin-bottom: 20px;
        }

        /* --- SYNC TRACKER --- */
        #sync-tracker {
            position: absolute; top: 20px; width: 100%; text-align: center;
            font-family: 'Cinzel', serif; font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.5); 
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            z-index: 40; pointer-events: none; transition: color 0.3s;
        }
        #sync-tracker.full { color: #39ff14; text-shadow: 0 0 20px #39ff14; }

        /* --- LAYERS --- */
        /* SVG sits at the bottom */
        svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: block; z-index: 1; }
        
        /* Canvas sits on top of SVG */
        #trace-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2; 
            pointer-events: none;
            /* Note: We removed the CSS clip-path to fix the bug. Clipping is now done in JS. */
            mix-blend-mode: screen; /* Helps the texture blend nicely */
        }

        /* 1. THE DIM BASE PATH (Ghost Bridge) */
        .path-base {
            fill: none; 
            stroke: url(#bridgePattern); 
            stroke-width: 50px; 
            stroke-linecap: round; 
            stroke-linejoin: round;
            /* UPDATED: Increased visibility */
            opacity: 0.5; 
            filter: grayscale(100%) brightness(0.7); /* Slightly brighter but still grey */
        }

        /* 2. THE HITBOX */
        .path-hitbox { fill: none; stroke:
