<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Ropers</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .vial-rack { display: flex; justify-content: center; gap: 30px; margin: 40px 0; perspective: 1000px; flex-wrap: wrap;}
        .vial-unit { display: flex; flex-direction: column; align-items: center; width: 120px; transition: transform 0.3s, opacity 0.3s; }
        .vial-unit:hover { transform: translateZ(20px); }
        .vial-display { width: 120px; height: 240px; position: relative; }
        .vial-bg { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; filter: drop-shadow(0 10px 10px #000); opacity: 0.8; }
        .vial-mask { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; overflow: hidden; z-index: 2; transition: height 0.6s cubic-bezier(0.22, 1, 0.36, 1); filter: drop-shadow(0 0 15px var(--blood)); }
        .vial-fg { width: 120px; height: 240px; position: absolute; bottom: 0; left: 0; }
        .vial-unit input { background: rgba(0,0,0,0.5); border: none; border-bottom: 2px solid var(--gold-shadow); color: var(--gold-highlight); font-family: 'Cinzel'; font-size: 1.5rem; text-align: center; width: 80px; margin-top: 15px; padding: 5px; transition: 0.3s; }
        .vial-unit input:focus { outline: none; border-color: var(--gold-highlight); background: rgba(0,0,0,0.8); }
        
        /* Auto-Highlight Logic Classes */
        .vial-safe { opacity: 0.5; transform: scale(0.95); }
        .vial-danger .vial-mask { filter: drop-shadow(0 0 25px var(--blood-bright)); }
        .vial-danger input { border-color: var(--blood-bright); color: var(--blood-bright); font-weight: bold; }

        /* Broken/Heal Effect */
        .vial-broken .vial-bg, .vial-broken .vial-mask { opacity: 0.1; filter: grayscale(100%); transition: 0.5s; }
        .heal-feedback { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: var(--gold-highlight); font-family: 'Cinzel'; font-weight: bold; font-size: 1.2rem;
            text-align: center; opacity: 0; pointer-events: none; width: 100%; z-index: 10;
            text-shadow: 0 0 10px var(--gold-shadow);
        }
        .vial-broken .heal-feedback { opacity: 1; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0); } to { transform: translate(-50%, -50%) scale(1); } }

        @media (max-width: 768px) {
            .vial-rack { gap: 10px; }
            .vial-unit { width: 80px; }
            .vial-display { width: 80px; height: 160px; }
            .vial-fg { width: 80px; height: 160px; }
            .vial-unit input { width: 60px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="screen">
        <h2>Specimen Feeding</h2>
        <p>Fill the vials with blood by inputting damage rolls. Beware the <span style="color:var(--blood-bright)">Hungriest Specimen</span>.</p>
        
        <div class="vial-rack">
            <div class="vial-unit" id="vial-unit-1">
                <div class="vial-display">
                    <img src="assets/vial-empty.webp" class="vial-bg">
                    <div class="vial-mask" id="mask-1"><img src="assets/vial-complete.webp" class="vial-fg"></div>
                    <div class="heal-feedback">VIAL FULL<br>(HEAL 1d8)</div>
                </div>
                <input type="number" id="dmg-1" value="0" oninput="updateVials()">
            </div>
            <div class="vial-unit" id="vial-unit-2">
                <div class="vial-display">
                    <img src="assets/vial-empty.webp" class="vial-bg">
                    <div class="vial-mask" id="mask-2"><img src="assets/vial-complete.webp" class="vial-fg"></div>
                    <div class="heal-feedback">VIAL BROKEN<br>HEAL 1d8</div>
                </div>
                <input type="number" id="dmg-2" value="0" oninput="updateVials()">
            </div>
            <div class="vial-unit" id="vial-unit-3">
                <div class="vial-display">
                    <img src="assets/vial-empty.webp" class="vial-bg">
                    <div class="vial-mask" id="mask-3"><img src="assets/vial-complete.webp" class="vial-fg"></div>
                    <div class="heal-feedback">VIAL BROKEN<br>HEAL 1d8</div>
                </div>
                <input type="number" id="dmg-3" value="0" oninput="updateVials()">
            </div>
            <div class="vial-unit" id="vial-unit-4">
                <div class="vial-display">
                    <img src="assets/vial-empty.webp" class="vial-bg">
                    <div class="vial-mask" id="mask-4"><img src="assets/vial-complete.webp" class="vial-fg"></div>
                    <div class="heal-feedback">VIAL BROKEN<br>HEAL 1d8</div>
                </div>
                <input type="number" id="dmg-4" value="0" oninput="updateVials()">
            </div>
        </div>
        <button class="back-btn" onclick="location.href='index.html'">Return to Hub</button>
    </div>

    <script>
        function updateVials() {
    const maxHP = 25; 
    const inputs = [
        { id: 1, val: parseInt(document.getElementById(`dmg-1`).value) || 0 },
        { id: 2, val: parseInt(document.getElementById(`dmg-2`).value) || 0 },
        { id: 3, val: parseInt(document.getElementById(`dmg-3`).value) || 0 },
        { id: 4, val: parseInt(document.getElementById(`dmg-4`).value) || 0 }
    ];

    inputs.forEach(item => {
        let pct = (item.val / maxHP) * 100;
        if(pct > 100) pct = 100;
        document.getElementById(`mask-${item.id}`).style.height = pct + '%';
    });

    const allZero = inputs.every(i => i.val === 0);
    if (allZero) {
        document.querySelectorAll('.vial-unit').forEach(u => {
            u.classList.remove('vial-danger', 'vial-safe', 'vial-broken');
        });
        return;
    }

    const activeInputs = inputs.filter(i => i.val < maxHP);
    const minVal = activeInputs.length > 0 ? Math.min(...activeInputs.map(i => i.val)) : -1;

    inputs.forEach(item => {
        const unit = document.getElementById(`vial-unit-${item.id}`);
        if (item.val >= maxHP) {
            unit.classList.add('vial-broken');
            unit.classList.remove('vial-danger', 'vial-safe');
        } else if (item.val === minVal) {
            unit.classList.add('vial-danger');
            unit.classList.remove('vial-safe', 'vial-broken');
        } else {
            unit.classList.add('vial-safe');
            unit.classList.remove('vial-danger', 'vial-broken');
        }
    });
}
    </script>
</body>
</html>
