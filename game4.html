<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Ropers</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .vial-rack { display: flex; justify-content: center; gap: 20px; margin: 40px 0; perspective: 1000px; flex-wrap: wrap;}
        .vial-unit { display: flex; flex-direction: column; align-items: center; width: 100px; transition: transform 0.3s, opacity 0.3s; }
        .vial-unit:hover { transform: translateZ(20px); }
        .vial-display { width: 100px; height: 200px; position: relative; }
        .vial-bg { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; filter: drop-shadow(0 10px 10px #000); opacity: 0.8; }
        .vial-mask { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; overflow: hidden; z-index: 2; transition: height 0.6s cubic-bezier(0.22, 1, 0.36, 1); filter: drop-shadow(0 0 15px var(--blood)); }
        .vial-fg { width: 100px; height: 200px; position: absolute; bottom: 0; left: 0; }
        .vial-unit input { background: rgba(0,0,0,0.5); border: none; border-bottom: 2px solid var(--gold-shadow); color: var(--gold-highlight); font-family: 'Cinzel'; font-size: 1.5rem; text-align: center; width: 80px; margin-top: 15px; padding: 5px; transition: 0.3s; }
        .vial-unit input:focus { outline: none; border-color: var(--gold-highlight); background: rgba(0,0,0,0.8); }
        
        /* Auto-Highlight Logic Classes */
        .vial-safe { opacity: 0.5; transform: scale(0.95); }
        .vial-danger .vial-mask { filter: drop-shadow(0 0 25px var(--blood-bright)); }
        .vial-danger input { border-color: var(--blood-bright); color: var(--blood-bright); font-weight: bold; }

        @media (max-width: 768px) {
            .vial-rack { gap: 10px; }
            .vial-unit { width: 80px; }
            .vial-display { width: 80px; height: 160px; }
            .vial-fg { width: 80px; height: 160px; }
            .vial-unit input { width: 60px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="screen">
        <h2>Specimen Feeding</h2>
        <p>Fill the vials with blood. Input dice rolls. Beware the <span style="color:var(--blood-bright)">Hungriest Specimen</span>.</p>
        
        <div class="vial-rack">
            <div class="vial-unit" id="vial-unit-1">
                <div class="vial-display">
                    <img src="assets/vial-empty.webp" class="vial-bg">
                    <div class="vial-mask" id="mask-1"><img src="assets/vial-complete.webp" class="vial-fg"></div>
                </div>
                <input type="number" id="dmg-1" value="0" oninput="updateVials()">
            </div>
            <div class="vial-unit" id="vial-unit-2">
                <div class="vial-display">
                    <img src="assets/vial-empty.webp" class="vial-bg">
                    <div class="vial-mask" id="mask-2"><img src="assets/vial-complete.webp" class="vial-fg"></div>
                </div>
                <input type="number" id="dmg-2" value="0" oninput="updateVials()">
            </div>
            <div class="vial-unit" id="vial-unit-3">
                <div class="vial-display">
                    <img src="assets/vial-empty.webp" class="vial-bg">
                    <div class="vial-mask" id="mask-3"><img src="assets/vial-complete.webp" class="vial-fg"></div>
                </div>
                <input type="number" id="dmg-3" value="0" oninput="updateVials()">
            </div>
            <div class="vial-unit" id="vial-unit-4">
                <div class="vial-display">
                    <img src="assets/vial-empty.webp" class="vial-bg">
                    <div class="vial-mask" id="mask-4"><img src="assets/vial-complete.webp" class="vial-fg"></div>
                </div>
                <input type="number" id="dmg-4" value="0" oninput="updateVials()">
            </div>
        </div>
        <button class="back-btn" onclick="location.href='index.html'">Return to Hub</button>
    </div>

    <script>
        function updateVials() {
            const maxHP = 50; 
            const inputs = [
                { id: 1, val: parseInt(document.getElementById(`dmg-1`).value) || 0 },
                { id: 2, val: parseInt(document.getElementById(`dmg-2`).value) || 0 },
                { id: 3, val: parseInt(document.getElementById(`dmg-3`).value) || 0 },
                { id: 4, val: parseInt(document.getElementById(`dmg-4`).value) || 0 }
            ];

            inputs.forEach(item => {
                let pct = (item.val / maxHP) * 100;
                if(pct > 100) pct = 100;
                document.getElementById(`mask-${item.id}`).style.height = pct + '%';
            });

            const allZero = inputs.every(i => i.val === 0);
            if (allZero) {
                document.querySelectorAll('.vial-unit').forEach(u => {
                    u.classList.remove('vial-danger', 'vial-safe');
                });
                return;
            }

            const minVal = Math.min(...inputs.map(i => i.val));
            inputs.forEach(item => {
                const unit = document.getElementById(`vial-unit-${item.id}`);
                if (item.val === minVal) {
                    unit.classList.add('vial-danger');
                    unit.classList.remove('vial-safe');
                } else {
                    unit.classList.add('vial-safe');
                    unit.classList.remove('vial-danger');
                }
            });
        }
    </script>
</body>
</html>
